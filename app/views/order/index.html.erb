<%= render 'shared/nav' %>
<div class="order-container container" >
  <div class='order-row'>
    <div class='card shadow card-padding' style="width:1000px">
      <div class='card-title order-title'>
        <div class='display-4'>Make an Order</div>
      </div>
      <div class='card-body card-padding order-column'>
        <% if flash[:danger] %>
          <div class="alert alert-danger order-alert"><%= flash[:danger] %></div>
        <% end %>
        <%= form_with url: '/order', method: :post do |form| %>
          <div class='input'>
            1. Please select the type of order you would like to make:
            <div class="radio pt-4">
              <div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="flexRadioDefault"
                    id="buy"
                  />
                  <label class="form-check-label" for="buy"> Buy </label>
                </div>
              </div>
              <div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="radio"
                    name="flexRadioDefault"
                    id="sell"
                    checked
                  />
                  <label class="form-check-label" for="sell"> Sell </label>
                </div>
              </div>
            </div>
          </div>
          <div class='input'>
            2. Please select the coin you'd like to make an order for:
            <div class='pt-4'>
              <select id='coin' class="mdb-select md-form" onchange="update_price(event)">
                <% Coin.all.order(:name).each_with_index do |coin, index| %>
                  <option value="<%= index + 1 %>"><%= coin.name %></option>
                <% end %>
              </select>
            </div>
          </div>
          <div class='input'>
            3. Please enter the quantity of the coin for transaction:
            <div class='input-row'>
              <div class='pt-4'>
                <%= form.number_field :quantity, min: 0, step: 0.000001, required: true, oninput: "update_price(event)" %>
              </div>
            </div>
          </div>

          <div class="pt-3 mb-4">
            <%= submit_tag "Order", class: "btn btn-dark btn-lg btn-block", style: "width:100%;"%>
          </div>
          
        <% end %>
      </div>
      <div class='card-footer'>
        <h6><strong>Notice:</strong> Please be cautious with buying and selling cryptocurrencies. 
        Our systems provide security in relation to your linked BinanceUS account; however, any valid purchases and sales made are final,
        and cannot be renegotiated with us. Please visit <a href='https://www.binance.com/en/support'>Binance Customer Support</a>
        for any issues.</h6>
      </div>
    </div>
    <div class="card bg-dark mb-3 text-center rounded order-col" >
      <div class="card-title font-weight-bold sticky-top bg-dark table-title">Order History</div>
        <div class=" font-weight-bold" style="color:white">
          <table class="table table-gray">
            <thead>
              <tr>
                <th scope="col" class="bg-dark" style="color:white">Side</th>
                <th scope="col" class="bg-dark" style="color:white">Coin</th>
                <th scope="col" class="bg-dark" style="color:white">Amount</th>
                <th scope="col" class="bg-dark" style="color:white">Executed</th>
              </tr>
            </thead>
            <tbody class="table-body scrollbar-orders ">
              <% @orders.order(created_at: :desc).each do |order| %>
                <tr>
                  <td style="color:white"><%=order.side%></td>
                  <td style="color:white"><%=order.symbol%></td>
                  <td style="color:white"><%=order.amount%></td>
                  <td style="color:white"><%=order.created_at%></td>
                </tr>
              <%end%>
            </tbody>
          </table>
        </div>
    </div>
  </div>
</div>
<script type='text/javascript'>

  function update_price(e) {
    e.preventDefault();
    const coin = $('#coin option:selected').text();
    const buy = $('input[id="buy"]:checked').val() === 'true';
    const amount = $('#quantity').val();
    console.log(coin)
    console.log(buy)
    console.log(amount)
  }

</script>


